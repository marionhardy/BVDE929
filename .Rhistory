data = data[rowSums(cols) >= 4, ]
all = all[rowSums(cols) >= 4, ]
dim(all)
table(cols)
all = all[rowSums(cols) >= 4, ]
dim(all)
all1 = all[rowSums(cols) >= 4, ]
dim(all1)
all1 = all[rowSums(cols) >= 1, ]
dim(all1)
rowSums(cols)
lall =
all %>%
pivot_longer(c(10:13),
names_to = "Treatment",
values_to = "Abundance")
lall %>%
ggplot(aes(x = Abundance,
color = state, fill = state))+
geom_histogram(alpha = 0.7, binwidth = 0.01)+
theme_bw()+
facet_wrap(~Treatment, scales = 'free_y')+
geom_vline(xintercept = 200, linetype = "dashed")
lall %>%
ggplot(aes(x = Retention_time,
color = state, fill = state))+
geom_histogram(alpha = 0.7, binwidth = 0.1)+
theme_bw()+
facet_wrap(~Treatment, scales = 'free_y')
TRUE&FALSE
TRUE|FALSE
View(lall)
com_pep = lall %>%
filter(state == "Not oxidated" & Treatment %in% c("F1_H2O2","F2_H2O2") |
state == "Not oxidated" & Treatment %in% c("F1_H2O2","F2_H2O2"))
com_pep = lall %>%
filter(state == "Not oxidated" & Treatment %in% c("F1_H2O2","F2_H2O2") |
state == "Oxidated" & Treatment %in% c("F1_ctrl","F2_ctrl"))
View(com_pep)
com_pep = lall %>%
filter(state == "Not oxidated" & Treatment %in% c("F1_H2O2","F2_H2O2") |
state == "Oxidated" & Treatment %in% c("F1_ctrl","F2_ctrl")) %>%
select(`Annotated Sequence`, Modifications.x, Abundance, state, Treatment)
View(com_pep)
table(com_pep$state, com_pep$Treatment)
com_pep = lall %>%
filter(state == "Not oxidated" & Treatment %in% c("F1_H2O2","F2_H2O2") |
state == "Oxidated" & Treatment %in% c("F1_ctrl","F2_ctrl")) %>%
select(`Annotated Sequence`, Modifications.x, Abundance, state, Treatment) %>%
drop_na(Abundance)
table(com_pep$state, com_pep$Treatment)
com_pep = lall %>%
filter(state == "Not oxidated" & Treatment %in% c("F1_ctrl","F2_ctrl") |
state == "Oxidated" & Treatment %in% c("F1_H2O2","F2_H2O2")) %>%
select(`Annotated Sequence`, Modifications.x, Abundance, state, Treatment) %>%
drop_na(Abundance)
table(com_pep$state, com_pep$Treatment)
com_pep = lall %>%
filter(state == "Not oxidated" & Treatment %in% c("F1_ctrl","F2_ctrl") &
state == "Oxidated" & Treatment %in% c("F1_H2O2","F2_H2O2")) %>%
select(`Annotated Sequence`, Modifications.x, Abundance, state, Treatment) %>%
drop_na(Abundance)
table(com_pep$state, com_pep$Treatment)
oxrows = com_pep %>% filter(state = "Oxidated")
oxrows = com_pep %>% filter(state == "Oxidated")
com_pep = lall %>%
filter(state == "Not oxidated" & Treatment %in% c("F1_ctrl","F2_ctrl") |
state == "Oxidated" & Treatment %in% c("F1_H2O2","F2_H2O2")) %>%
select(`Annotated Sequence`, Modifications.x, Abundance, state, Treatment) %>%
drop_na(Abundance)
table(com_pep$state, com_pep$Treatment)
oxrows = com_pep %>% filter(state == "Oxidated")
unoxrows = com_pep %>% filter(state == "Not oxidated")
left_join(oxrows,unoxrows)
left_join(oxrows,unoxrows, by = c("Annotated Sequence"))
temp = left_join(oxrows,unoxrows, by = c("Annotated Sequence"))
View(temp)
temp = inner_join(oxrows,unoxrows, by = c("Annotated Sequence"))
View(temp)
temp = inner_join(oxrows,unoxrows)
View(temp)
, by = c("Annotated Sequence")
temp = inner_join(oxrows,unoxrows, by = c("Annotated Sequence"))
View(temp)
com_pep = lall %>%
filter(state == "Not oxidated" & Treatment %in% c("F1_ctrl","F2_ctrl") |
state == "Oxidated" & Treatment %in% c("F1_H2O2","F2_H2O2")) %>%
select(`Annotated Sequence`, Modifications.x, Abundance, state, Treatment, Retention_time) %>%
drop_na(Abundance)
table(com_pep$state, com_pep$Treatment)
oxrows = com_pep %>% filter(state == "Oxidated")
unoxrows = com_pep %>% filter(state == "Not oxidated")
temp = inner_join(oxrows,unoxrows, by = c("Annotated Sequence"))
View(temp)
temp = inner_join(oxrows,unoxrows, by = c("Annotated Sequence"),
suffix = c("_H2O2", "_ctrl"))
View(temp)
targetpep = inner_join(oxrows,unoxrows, by = c("Annotated Sequence"),
suffix = c("_H2O2", "_ctrl"))
finalpep = targetpep$`Annotated Sequence`
lall %>%
filter(`Annotated Sequence` %in% finalpep) %>%
ggplot(aes(x = state,
y = Retention_time,
color = state))+
geom_violin()+
geom_boxplot()+
theme_bw()+
facet_wrap(.~Treatment)
View(lall)
lall %>%
filter(`Annotated Sequence` %in% finalpep) %>%
ggplot(aes(x = Abundance,
color = state, fill = state))+
geom_histogram(alpha = 0.7, binwidth = 0.01)+
theme_bw()+
facet_wrap(~Treatment, scales = 'free_y')+
geom_vline(xintercept = 200, linetype = "dashed")
lall %>%
filter(`Annotated Sequence` %in% finalpep) %>%
ggplot(aes(x = state,
y = Retention_time,
color = state))+
geom_violin()+
geom_boxplot()+
theme_bw()+
facet_wrap(.~Treatment)
lall %>%
filter(`Annotated Sequence` %in% finalpep) %>%
ggplot(aes(x = Retention_time,
color = state, fill = state))+
geom_histogram(alpha = 0.7, binwidth = 0.1)+
theme_bw()+
facet_wrap(~Treatment, scales = 'free_y')
lall %>%
filter(`Annotated Sequence` %in% finalpep) %>%
ggplot(aes(x = Abundance,
color = state, fill = state))+
geom_histogram(alpha = 0.7, binwidth = 0.1)+
theme_bw()+
facet_wrap(~Treatment, scales = 'free_y')+
geom_vline(xintercept = 200, linetype = "dashed")
lall %>%
filter(`Annotated Sequence` %in% finalpep) %>%
ggplot(aes(x = Abundance,
color = state, fill = state))+
geom_histogram(alpha = 0.7, binwidth = 10)+
theme_bw()+
facet_wrap(~Treatment, scales = 'free_y')+
geom_vline(xintercept = 200, linetype = "dashed")
lall %>%
filter(`Annotated Sequence` %in% finalpep) %>%
ggplot(aes(x = Abundance,
color = state, fill = state))+
geom_histogram(alpha = 0.7, binwidth = 5)+
theme_bw()+
facet_wrap(~Treatment, scales = 'free_y')+
geom_vline(xintercept = 200, linetype = "dashed")
lall %>%
filter(`Annotated Sequence` %in% finalpep) %>%
ggplot(aes(x = Abundance,
color = state, fill = state))+
geom_histogram(alpha = 0.7, binwidth = 1)+
theme_bw()+
facet_wrap(~Treatment, scales = 'free_y')+
geom_vline(xintercept = 200, linetype = "dashed")
lall %>%
filter(`Annotated Sequence` %in% finalpep) %>%
ggplot(aes(x = `Annotated Sequence`,
y = Retention_time,
color = state))+
geom_violin()+
geom_boxplot()+
theme_bw()+
facet_wrap(.~Treatment)
lall %>%
filter(`Annotated Sequence` %in% finalpep) %>%
ggplot(aes(x = `Annotated Sequence`,
y = Retention_time,
color = state))+
geom_boxplot()+
theme_bw()+
facet_wrap(.~Treatment)
lall %>%
filter(`Annotated Sequence` %in% finalpep) %>%
head(25) %>%
ggplot(aes(x = `Annotated Sequence`,
y = Retention_time,
color = state))+
geom_boxplot()+
theme_bw()+
facet_wrap(.~Treatment)
lall %>%
filter(`Annotated Sequence` %in% finalpep) %>%
head(25)
lall %>%
filter(`Annotated Sequence` %in% finalpep) %>%
head(50) %>%
ggplot(aes(x = `Annotated Sequence`,
y = Retention_time,
color = state))+
geom_boxplot()+
theme_bw()+
facet_wrap(.~Treatment)
lall %>%
filter(`Annotated Sequence` %in% finalpep) %>%
head(50) %>%
ggplot(aes(x = `Annotated Sequence`,
y = Retention_time,
color = state))+
geom_boxplot()+
theme_bw()+
facet_wrap(.~Treatment)+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
lall %>%
filter(`Annotated Sequence` %in% finalpep) %>%
head(50) %>%
ggplot(aes(x = `Annotated Sequence`,
y = Retention_time,
color = state))+
geom_boxplot()+
theme_bw()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
lall %>%
filter(`Annotated Sequence` %in% finalpep) %>%
ggplot(aes(x = `Annotated Sequence`,
y = Retention_time,
color = state))+
geom_boxplot()+
theme_bw()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
lall %>%
filter(`Annotated Sequence` %in% finalpep)
lall %>%
filter(`Annotated Sequence` %in% finalpep) %>%
head(500) %>%
ggplot(aes(x = `Annotated Sequence`,
y = Retention_time,
color = state))+
geom_boxplot()+
theme_bw()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
lall %>%
filter(`Annotated Sequence` %in% finalpep) %>%
head(500) %>%
ggplot(aes(x = `Annotated Sequence`,
y = Retention_time,
color = state))+
geom_points()+
theme_bw()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
lall %>%
filter(`Annotated Sequence` %in% finalpep) %>%
head(500) %>%
ggplot(aes(x = `Annotated Sequence`,
y = Retention_time,
color = state))+
geom_point()+
theme_bw()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
unique(temp$`Annotated Sequence`)
table(unique(temp$`Annotated Sequence`))
n(unique(temp$`Annotated Sequence`))
table(duplicated(com_pep$`Annotated Sequence`))
View(com_pep)
View(com_pep)
table(duplicated(finalpep$`Annotated Sequence`))
table(duplicated(targetpep$`Annotated Sequence`))
table(unique(targetpep$`Annotated Sequence`))
count(targetpep$`Annotated Sequence`))
count(targetpep$`Annotated Sequence`)
count(n(targetpep$`Annotated Sequence`))
table(duplicated(finalpep$`Annotated Sequence`))
View(targetpep)
View(lall)
lall %>%
filter(`Annotated Sequence` %in% finalpep) %>%
head(500) %>%
ggplot(aes(x = `Annotated Sequence`,
y = Retention_time,
color = state))+
geom_point(position = "dodge")+
theme_bw()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
lall %>%
filter(`Annotated Sequence` %in% finalpep) %>%
head(500) %>%
ggplot(aes(x = `Annotated Sequence`,
y = Retention_time,
color = state))+
geom_point(position = position_dodge(width = 0.1))+
theme_bw()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
lall %>%
filter(`Annotated Sequence` %in% finalpep) %>%
head(500) %>%
ggplot(aes(x = `Annotated Sequence`,
y = Retention_time,
color = state))+
geom_point(position = position_dodge(width = 1))+
theme_bw()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
lall %>%
filter(`Annotated Sequence` %in% finalpep) %>%
head(700) %>%
ggplot(aes(x = `Annotated Sequence`,
y = Retention_time,
color = state))+
geom_point(size = 1, position = position_dodge(width = 1))+
theme_bw()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
lall %>%
filter(`Annotated Sequence` %in% finalpep) %>%
head(700) %>%
ggplot(aes(x = `Annotated Sequence`,
y = Retention_time,
color = state))+
geom_point(size = 1, position = position_dodge(width = 2))+
theme_bw()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
lall %>%
filter(`Annotated Sequence` %in% finalpep) %>%
head(700) %>%
ggplot(aes(x = `Annotated Sequence`,
y = Retention_time,
color = state))+
geom_point(size = 1, position = position_dodge(width = 4))+
theme_bw()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
lall %>%
filter(`Annotated Sequence` %in% finalpep) %>%
head(700) %>%
ggplot(aes(x = `Annotated Sequence`,
y = Retention_time,
color = state))+
geom_point(size = 1, position = position_dodge(width = 10))+
theme_bw()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
lall %>%
filter(`Annotated Sequence` %in% finalpep) %>%
head(700) %>%
ggplot(aes(x = `Annotated Sequence`,
y = Retention_time,
color = state))+
geom_point(size = 1, position = position_dodge(width = 2))+
theme_bw()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
lall %>%
filter(`Annotated Sequence` %in% finalpep) %>%
head(700) %>%
ggplot(aes(x = `Annotated Sequence`,
y = Retention_time,
color = state))+
geom_point(size = 1, position = position_dodge(width = 1))+
theme_bw()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```{r, fig.height=10, fig.width=20}
# Chunk 1: setup
knitr::opts_chunk$set(message = FALSE, cache = TRUE, echo = FALSE, warning = F, cache.lazy = F)
library(tidyverse)
library(readxl)
# Chunk 2: data loading
data = read_xlsx("./data/BVDE_929_data.xlsx", sheet = "PeptideGroups")
# Chunk 3
# Filtering out contaminants
dim(data)
data =
data %>%
filter(Contaminant != "TRUE")
dim(data)
# Chunk 4
# Reduce the number of rows to keep only the ones of interest
data = data[,c(3:5,9,10,16:23,29:44)]
colnames(data)
colnames(data)[10:13] = c("F1_H2O2","F1_ctrl","F2_H2O2","F2_ctrl")
# Filter out peptides which appear in <4 conditions
cols = sapply(data[14:29], grepl, pattern = "Not.*{2,}")
data = data[rowSums(cols) >= 4, ]
dim(data)
# Filter out PSM <1
data =
data %>%
filter(!`# PSMs` < 1)
# Chunk 5
pepox =
data %>%
filter(grepl("Oxidation", Modifications))
pepctrl=
data %>%
filter(!grepl("Oxidation", Modifications))
data =
data %>%
mutate(state = case_when(
grepl("Oxidation", Modifications) ~ "Oxidated",
!grepl("Oxidation", Modifications) ~ "Not oxidated"))
# Chunk 6
dim(pepox)
head(pepox)
dim(pepctrl)
head(pepctrl)
# Chunk 7
# Add annotations for which samples is which conditions
ldata =
data %>%
pivot_longer(c(10:13),
names_to = "Treatment",
values_to = "Abundance")
ldata %>%
ggplot(aes(x = Treatment,
y = Abundance,
color = state))+
geom_violin(position = position_dodge(width = 1))+
geom_boxplot(position = position_dodge(width = 1))+
theme_bw()
ldata %>%
ggplot(aes(x = Abundance,
color = state, fill = state))+
geom_histogram(alpha = 0.7, binwidth = 5)+
theme_bw()+
facet_wrap(~Treatment)
ldata %>%
ggplot(aes(x = Abundance,
color = state, fill = state))+
geom_histogram(alpha = 0.7, binwidth = 0.01)+
theme_bw()+
facet_wrap(~Treatment, scales = 'free_y')
# Chunk 8
data1 = read_xlsx("./data/BVDE_929_data.xlsx", sheet = "PSMs")
data1 = data1[,c(5:9,27,33:38)]
data1 =
data1 %>% mutate(Sequence = toupper(`Annotated Sequence`))
all = left_join(data, data1, by = c("Annotated Sequence" = "Sequence"))
# Chunk 9
colnames(all)[36] = "Retention_time"
table(duplicated(all$`Annotated Sequence`))
all = all[duplicated(all$`Annotated Sequence`),]
lall =
all %>%
pivot_longer(c(10:13),
names_to = "Treatment",
values_to = "Abundance")
lall %>%
ggplot(aes(x = Abundance,
color = state, fill = state))+
geom_histogram(alpha = 0.7, binwidth = 0.01)+
theme_bw()+
facet_wrap(~Treatment, scales = 'free_y')+
geom_vline(xintercept = 200, linetype = "dashed")
lall %>%
ggplot(aes(x = Retention_time,
color = state, fill = state))+
geom_histogram(alpha = 0.7, binwidth = 0.1)+
theme_bw()+
facet_wrap(~Treatment, scales = 'free_y')
lall %>%
ggplot(aes(x = state,
y = Retention_time,
color = state))+
geom_violin()+
geom_boxplot()+
theme_bw()+
facet_wrap(.~Treatment)
# Chunk 10
com_pep = lall %>%
filter(state == "Not oxidated" & Treatment %in% c("F1_ctrl","F2_ctrl") |
state == "Oxidated" & Treatment %in% c("F1_H2O2","F2_H2O2")) %>%
select(`Annotated Sequence`, Modifications.x, Abundance, state, Treatment, Retention_time) %>%
drop_na(Abundance)
table(com_pep$state, com_pep$Treatment)
# I have the peptides oxidated in H2O2 and the peptides unoxidated in ctrl
oxrows = com_pep %>% filter(state == "Oxidated")
unoxrows = com_pep %>% filter(state == "Not oxidated")
targetpep = inner_join(oxrows,unoxrows, by = c("Annotated Sequence"),
suffix = c("_H2O2", "_ctrl"))
finalpep = targetpep$`Annotated Sequence`
# Chunk 11
lall %>%
filter(`Annotated Sequence` %in% finalpep) %>%
ggplot(aes(x = Abundance,
color = state, fill = state))+
geom_histogram(alpha = 0.7, binwidth = 1)+
theme_bw()+
facet_wrap(~Treatment, scales = 'free_y')+
geom_vline(xintercept = 200, linetype = "dashed")
lall %>%
filter(`Annotated Sequence` %in% finalpep) %>%
ggplot(aes(x = state,
y = Retention_time,
color = state))+
geom_violin()+
geom_boxplot()+
theme_bw()+
facet_wrap(.~Treatment)
# Chunk 12
lall %>%
filter(`Annotated Sequence` %in% finalpep) %>%
head(700) %>%
ggplot(aes(x = `Annotated Sequence`,
y = Retention_time,
color = state))+
geom_point(size = 1, position = position_dodge(width = 1))+
theme_bw()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
# Chunk 13
# Drop peptides with similar retention times
# Keep peptides with abundance H2O2 > ctrl
View(targetpep)
write.csv(targetpep,"./data_output/matched_condition_peptides.csv")
write.csv(targetpep,"./data_output/matched_condition_peptides.csv")
save.image(file = "BVDE929.RData")
library(readxl)
load("F:/R/Sophie/BVDE929/data_output/BVDE929.RData")
